/*
 * Build script for Surgical Risk Calculator Prototype.
 */

apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'eclipse-wtp'
// Generates code coverage report. Run task 'jacocoTestReport' to do so.
apply plugin: 'jacoco'

// Basic build properties
sourceCompatibility = '1.7'

repositories {
    // Use 'maven central' for resolving dependencies.
    mavenCentral()
}

/* Versions of dependencies */
def springVersion = '4.0.7.RELEASE'
def slf4jVersion = '1.7.5'

configurations {
    // Don't ever depend on commons-logging, we use jcl-over-sl4j instead.
    all*.exclude module: 'commons-logging'
    
    // org.glassfish.web:javax.servlet.jsp.jstl tries to include these, but we
    // want them 'provided' scope.
    runtime.exclude module: 'servlet-api'
}    

dependencies {

    /* Java EE 7 dependencies */

    // Provided by the container (Tomcat).
    providedCompile 'javax.servlet:javax.servlet-api:3.0.1'
    providedCompile 'javax.servlet.jsp:jsp-api:2.1'
    // These are not provided by the container (Tomcat).
	compile 'javax.inject:javax.inject:1'
	compile 'org.glassfish.web:javax.servlet.jsp.jstl:1.2.1'
	
	/* Other libraries */

    compile group: 'org.slf4j', name: 'slf4j-api', version: slf4jVersion
    compile group: 'org.slf4j', name: 'jcl-over-slf4j', version: slf4jVersion
    compile 'org.hibernate:hibernate-core:4.2.13.Final'
	compile group: 'org.springframework', name: 'spring-core', version: springVersion
	compile group: 'org.springframework', name: 'spring-webmvc', version: springVersion
	compile group: 'org.springframework', name: 'spring-orm', version: springVersion
	compile 'joda-time:joda-time:2.3'
	compile 'org.apache.tiles:tiles-jsp:2.2.2'

    runtime 'ch.qos.logback:logback-classic:1.1.2'
    
    /* Test dependencies */

    testCompile 'junit:junit:4.11'
    testCompile 'org.mockito:mockito-core:1.9.5'
	testCompile group: 'org.springframework', name: 'spring-test', version: springVersion
	testCompile 'nl.jqno.equalsverifier:equalsverifier:1.5'
	
	testRuntime 'org.hsqldb:hsqldb:2.3.2'
}

// Hardcode Eclipse servlet spec version because eclipse-wtp just assumes 2.4.
eclipse {
    wtp {
	facet {
	    facet name: 'java', version: sourceCompatibility
	    facet name: 'jst.web', version: '3.0'
	}
    }
}

